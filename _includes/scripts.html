<script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>

<script>
  // Small-screen toggle for generic left sidebars (page + post)
  (function() {
    document.addEventListener('DOMContentLoaded', function() {
      var mq = window.matchMedia('(max-width: 960px)');
      var initialized = false;

      function setupToggle() {
        if (!mq.matches || initialized) return;
        initialized = true;

        var pageSidebar = document.querySelector('.page-sidebar');
        var postSidebar = document.querySelector('.post-sidebar-left');

        // Prefer a page sidebar if present; otherwise use post sidebar
        var sidebar = pageSidebar || postSidebar;
        if (!sidebar) return;

        // Insert toggle button above the whole three-column layout
        var layout = document.querySelector('.layout-three-column');
        if (!layout || layout.parentNode.querySelector('.sidebar-toggle')) return;

        var btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'sidebar-toggle';
        btn.setAttribute('aria-label', 'Toggle navigation');
        btn.innerHTML = '&#9776;';
        btn.addEventListener('click', function() {
          sidebar.classList.toggle('is-open');
        });

        layout.parentNode.insertBefore(btn, layout);
      }

      setupToggle();
      mq.addEventListener('change', function(e) {
        if (e.matches) setupToggle();
      });
    });
  })();
</script>

<script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: ["tex2jax.js"],
     jax: ["input/TeX", "output/HTML-CSS"],
     tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
       processEscapes: true
     },
     "HTML-CSS": { availableFonts: ["TeX"] }
   });
</script>

<script>
  (function() {
    document.addEventListener('DOMContentLoaded', function() {
      // Only build TOC for numbered post/page content
      var content = document.querySelector('.post-content.numbered');
      if (!content) return;

      // Allow disabling via `toc: false` in front matter
      if (!{{ page.toc | default: true | jsonify }}) return;

      var headings = content.querySelectorAll('h2, h3');
      if (!headings.length) return;

      // Decide which TOC container to use: post or page
      var tocContainer = document.querySelector('.post-toc .toc-inner') ||
                         document.querySelector('.page-toc .toc-inner');
      if (!tocContainer) return;

      // Build TOC header and list (toggle button lives in header)
      tocContainer.innerHTML = '';

      var headingEl = document.createElement('h2');
      headingEl.textContent = 'In this article';

      var ul = document.createElement('ul');

      var h2Count = 0, h3Count = 0;

      headings.forEach(function(h) {
        if (!h.id) {
          h.id = h.textContent.trim().toLowerCase()
            .replace(/[^\w\- ]+/g, '')
            .replace(/\s+/g, '-');
        }

        var li = document.createElement('li');
        li.className = 'toc-level-' + h.tagName.toLowerCase();

        var a = document.createElement('a');
        a.href = '#' + h.id;

        // Compute numbering that matches the in-content numbering script
        var tag = h.tagName.toLowerCase();
        var numberText = '';
        if (tag === 'h2') {
          h2Count += 1;
          h3Count = 0;
          numberText = h2Count + '.\u00A0';
        } else if (tag === 'h3') {
          if (h2Count === 0) h2Count = 1;
          h3Count += 1;
          numberText = h2Count + '.' + h3Count + '.\u00A0';
        }

        a.textContent = (numberText ? numberText : '') + h.textContent;

        li.appendChild(a);
        ul.appendChild(li);
      });

      tocContainer.appendChild(headingEl);
      tocContainer.appendChild(ul);
    });
  })();
</script>

    <script>
      // Mobile nav hamburger toggle: keep search visible, collapse other links into a dropdown
      (function() {
        document.addEventListener('DOMContentLoaded', function() {
          var toggle = document.querySelector('.nav-toggle');
          var headerInner = document.querySelector('.header-inner');
          var siteNav = document.querySelector('.site-nav');
          if (!toggle || !headerInner || !siteNav) return;

          toggle.addEventListener('click', function(e) {
            var expanded = toggle.getAttribute('aria-expanded') === 'true';
            toggle.setAttribute('aria-expanded', String(!expanded));
            headerInner.classList.toggle('nav-open');
          });

          // Close mobile nav when clicking outside
          document.addEventListener('click', function(e) {
            if (!headerInner.classList.contains('nav-open')) return;
            if (siteNav.contains(e.target) || toggle.contains(e.target)) return;
            headerInner.classList.remove('nav-open');
            toggle.setAttribute('aria-expanded', 'false');
          });
        });
      })();
    </script>

    <script>
      // Auto-number level-2 and level-3 headings inside article/page content
      (function() {
        document.addEventListener('DOMContentLoaded', function() {
          var containers = document.querySelectorAll('.post-content.numbered');
          if (!containers || !containers.length) return;

          containers.forEach(function(container) {
            var headings = container.querySelectorAll('h2, h3');
            var h2Count = 0, h3Count = 0;

            headings.forEach(function(h) {
              var tag = h.tagName.toLowerCase();

              // Skip if numbering already applied
              if (h.querySelector('.heading-number')) return;

              if (tag === 'h2') {
                h2Count += 1;
                h3Count = 0;
                var num = h2Count + '.\u00A0';
                var span = document.createElement('span');
                span.className = 'heading-number';
                span.setAttribute('aria-hidden', 'true');
                span.textContent = num;
                h.insertBefore(span, h.firstChild);
              } else if (tag === 'h3') {
                // If there's no preceding h2, start numbering at 1
                if (h2Count === 0) h2Count = 1;
                h3Count += 1;
                var num3 = h2Count + '.' + h3Count + '.\u00A0';
                var span3 = document.createElement('span');
                span3.className = 'heading-number';
                span3.setAttribute('aria-hidden', 'true');
                span3.textContent = num3;
                h.insertBefore(span3, h.firstChild);
              }
            });
          });
        });
      })();
    </script>


    <script>
      // Theme toggle: initialize from localStorage / prefers-color-scheme, toggle on click
      (function() {
        var STORAGE_KEY = 'theme';

        function applyTheme(theme) {
          if (theme === 'dark') document.documentElement.classList.add('dark');
          else document.documentElement.classList.remove('dark');
          var btn = document.getElementById('theme-toggle');
          if (btn) btn.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
        }

        document.addEventListener('DOMContentLoaded', function() {
          var btn = document.getElementById('theme-toggle');
          if (!btn) return;

          // Determine initial theme
          var saved = null;
          try { saved = localStorage.getItem(STORAGE_KEY); } catch (e) { saved = null; }
          if (saved === 'dark' || saved === 'light') {
            applyTheme(saved);
          } else {
            var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(prefersDark ? 'dark' : 'light');
          }

          // Toggle handler
          btn.addEventListener('click', function() {
            var isDark = document.documentElement.classList.contains('dark');
            var next = isDark ? 'light' : 'dark';
            applyTheme(next);
            try { localStorage.setItem(STORAGE_KEY, next); } catch (e) {}
          });
        });
      })();
    </script>

